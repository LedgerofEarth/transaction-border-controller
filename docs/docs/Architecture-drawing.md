┌─────────────────────────────────────────────────────────────────────────┐
│                          MERCHANT PAGE                                   │
│                    window.tgp.requestPayment()                          │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                     COREPROVE EXTENSION (TGP-EXT-00)                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │   Content   │  │  Background │  │   Popup     │  │  ZK Prover  │    │
│  │   Script    │──│   Service   │──│    UI       │  │  (WASM)     │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                          │                               │              │
│                    TGP Messages                    ZK Proof Gen         │
│                    (TGP-00 v3.2)                  (TGP-EXT-ZK-00)       │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                            WebSocket (wss://)
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                    TRANSACTION BORDER CONTROLLER (TBC)                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │  L1-L5      │  │     L4      │  │   Rewrite   │  │  Nullifier  │    │
│  │  Verify     │  │  ZK Verify  │  │   Engine    │  │   Store     │    │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │
│                                                                          │
│               TGP-TBC-SEC-00 (Security) + TGP-EXT-ZK-00 (ZK)            │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                              RPC Calls
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                      ON-CHAIN (CoreProve-00 v0.9)                        │
│  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────┐  │
│  │  Merchant Factory   │  │ Settlement Contract │  │  ReceiptVault   │  │
│  │  (CREATE2 deploy)   │  │ (per merchant)      │  │  (epoch-based)  │  │
│  └─────────────────────┘  └─────────────────────┘  └─────────────────┘  │
│                                    │                       │            │
│                           buyerCommit()              mint()             │
│                           sellerCommit()                                │
└─────────────────────────────────────────────────────────────────────────┘